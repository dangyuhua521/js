<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
<link href="css/index.css" rel="stylesheet" />
</head>
<body>
	<div class="wrap" id="box">
		<header class="head clear">
			<h1 class="left">
				<a class="logo" href="javascript:;"></a>
				|
				<a href="javascript:;">邮箱</a>
			</h1>
			<nav  class="left">
				<a href="javascript:;">邮箱首页</a>|<a href="javascript:;">设置</a>
			</nav>
			<p class="hint1 left"></p>
			<p class="hint2 left"></p>
		</header>
		<div class="section clear">
			<div class="fuList left">
				<ul class="fuListBig">
					<li class="writeLetter">写信</li>
					<li class="collectLetter">收信</li>
					<li class="address">通讯录</li>
				</ul>
				<ul class="fuListSmall">
					<li class="inbox active">收件箱</li>
					<li class="StarMail">星标邮件</li>
					<li class="groupMail">群邮件</li>
					<li class="draftBox">草稿箱</li>
					<li class="beenSent">已发送</li>
					<li class="beenDel hover">已删除<a class="clearBtn" href="#">清空</a></li>
					<li class="dustbin">垃圾箱<a class="clearBtn" href="#">清空</a></li>
				</ul>
			</div>
			<div class="tBody left">
				<div class="title">
					收件箱(共96封,其中<a href="javascript:;">未读邮件</a>9封)
				</div>
				<div class="emailFunctions">
					<a id="delet" href="javascript:;">删除</a>
					<a href="javascript:;">彻底删除</a>
					<a href="javascript:;">转发</a>
					<a href="javascript:;">举报</a>
					<a href="javascript:;">全部标为已读</a>
					<a class="selectIcon" href="javascript:;">标记为...</a>
					<a class="selectIcon" href="javascript:;">移动到...</a>
				</div>
				<div class="emailList" id="emailCheckList">
					<header class="emailHead">
						<input type="checkbox" />
						<p><span></span><span></span></p>
					</header>
					<ul class="emailListUl" id="ulList">
						<!-- <li>
							<input type="checkbox">
							<div>
								<span>秒味课堂1</span>
								<span>2015-12-30</span>
							</div>
							<p>JS拖拽的进一步学习,移动与拉伸JS拖拽的进一步练习</p>
						</li> -->
					</ul>
				</div>
			</div>

		</div>
	</div>
		<div id="hint3" style="display:none;">选中2封邮件</div>
</body>

<script src="js/data.js"></script>

<script>
	//获取ul并渲染下面数据
	var emailListUl = document.getElementById('ulList');
	var beenDel = document.querySelector('.beenDel');

	list.forEach(function(e){
		e.checked = '';
	})
	render();

	//全选按钮
	var checkAllBox = emailCheckList.getElementsByTagName('input')[0];
	//给全选添加点击事件
	checkAllBox.onclick = function(ev){
		var checked = '';
		console.log(list.every(e=>e.checked))
		if(list.every(e=>e.checked)){
			checked = '';
		}else{
			checked = 'checked';
		}
		list.forEach(function(e){
			e.checked = checked;
		})
		render();
	}


	function chkNum(){
		var num = 0;
		list.forEach(e=>{
			if(e.checked){
				num++
			}
		})
		return num;
	}

	function render(){
		var str ='';
		for(var i =0; i<list.length;i++){
			str+=`<li class=${list[i].checked?'active':''}>
					<input type="checkbox" ${list[i].checked} >
					<div>
						<span>${list[i].caption}</span>
						<span>${list[i].time}</span>
					</div>
					<p>${list[i].desc}</p>
				</li>`
		}
		emailListUl.innerHTML = str;

		//所有的单选按钮
		var checkChoiceBox = emailListUl.getElementsByTagName('input');

		for(let i=0;i<checkChoiceBox.length;i++){
			checkChoiceBox[i].onmousedown = function(ev){
				ev.stopPropagation();
				var checked = '';
				// 如果点击选框对应的list里checked值为checked 那么将checked改成空
				if(list[i].checked){
					list[i].checked = '';
					// 如果取消选中时将全选状态改为false
					checkAllBox.checked = false;
				}else{
					list[i].checked = 'checked';
					// 如果list中所有checked都为真 那么将全选勾选上
					if(list.every(e=>e.checked)){
						checkAllBox.checked = true;
					}
				}
				render();
			}
		}

		emailListUl.onmousedown = function(ev){
			console.log('down')
			var num = chkNum();
			hint3.innerHTML = '选中'+num+'封邮件';
			hint3.style.display = '';
			hint3.style.left = ev.pageX+'px';
			hint3.style.top = ev.pageY+'px';
			document.onmousemove = function(e){
				console.log('move')
				hint3.style.left = e.pageX+'px';
				hint3.style.top = e.pageY+'px';
				document.onmouseup = function(e){
					document.onmousemove = document.onmouseup = null;
					hint3.style.display = 'none';
					var li = beenDel.getBoundingClientRect();
					if(e.pageX>li.left&&e.pageX<li.right&&e.pageY>li.top&&e.pageY<li.bottom){
						// list = list.filter(e=>e.checked=='')
						var arr = [];
						list.forEach(function(e){
							if(e.checked == ''){
								arr.push(e)
							}
						});
						list = arr;
					}
					render();
				}
			}
		}


	}

</script>
</html>
